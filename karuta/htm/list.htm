<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=9">
		<title>Karuta Production</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
		<link rel="icon" type="image/png" href="../../karuta/img/favicon.png" />
		<!-- =============================================================== -->
		<link rel="stylesheet" type="text/css" href="../../other/bootstrap/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="../../other/css/jquery-ui.css" />
		<link rel="stylesheet" type="text/css" href="../../other/css/font-awesome/css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="../../other/colorpicker/css/evol.colorpicker.css" />
		<link rel="stylesheet" type="text/css" href="../../karuta/css/karuta.css" />
		<!-- =========================================== -->
		<link rel="stylesheet" href="../../application/css/specific.css" />
		<!-- =========================================== -->
		<script src="../../other/js/jquery-1.10.2.js"></script>
		<script src="../../other/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="../../other/bootstrap/js/bootstrap.min.js"></script>
		<script src="../../other/js/jquery.ui.touch-punch.min.js"></script>
		<script src="../../other/js/jquery.tablesorter.min.js"></script>
		<script src="../../other/js/jquery_hotkeys.js"></script>
		<script src="../../karuta/js/karuta.js"></script>
		<script src="../../karuta/js/UICom.js"></script>
		<script src="../../karuta/js/batch.js"></script>
		<!-- =============================================================== -->
		<script src="../../other/js/jquery.ui.widget.js"></script>
		<script src="../../other/js/jquery.iframe-transport.js"></script>
		<script src="../../other/js/jquery.fileupload.js"></script>
		<!-- =============================================================== -->
		<script src="../../other/bootstrap-datepicker/bootstrap-datepicker.js"></script>
		<script src="../../other/bootstrap-datepicker/bootstrap-datepicker.fr.js"></script>
		<link rel="stylesheet" href="../../other/bootstrap-datepicker/datepicker.css" />
		<!-- =============================================================== -->
		<link rel="stylesheet" type="text/css" href='../../other/wysihtml5/bootstrap3-wysihtml5.min.css'/>
		<script src='../../other/wysihtml5/bootstrap3-wysihtml5.all.min.js'> </script>
		<!-- =============================================================== -->
		<link rel="stylesheet" type="text/css" href='../../socialnetwork/css/elgg.css'/>
		<link rel="stylesheet" type="text/css" href='../../socialnetwork/css/socialnetwork.css'/>
		<script src="../../socialnetwork/js/socialnetwork.js"></script>
		<script src="../../socialnetwork/js/socialnetwork_fr.js"></script>
		<script src="../../socialnetwork/js/moment-with-locales.min.js"></script>
		<!-- =============================================================== -->
		<script src="../../other/js/js.cookie.js"></script>
		<!-- =============================================================== -->
		<script src="../../karuta/js/model/Type_Node.js"></script>
		<script src="../../karuta/js/model/Type_Portfolio.js"></script>
		<script src="../../karuta/js/model/Type_User.js"></script>
		<script src="../../karuta/js/UICom.js"></script>
		<!-- =============================================================== -->
		<script src="../../application/js/_init.js"></script>
		<script src="../../application/js/create_batch.js"></script>
		<!-- =============================================================== -->
		<script src="../../karuta/js/version.js"></script>
		<script>
			//==============================
			function getList()
			//==============================
			{
				var html = "";
				var text1 = karutaStr[LANG]['projects'];
				var text2 = karutaStr[LANG]['portfolios'];
				if (USER.admin)
					text1 = karutaStr[LANG]['portfolios-admin'];
				html += "<h3 id='projects-label'>"+text1+"</h3>";
				html += "<div id='projects'></div>";
				html += "<h3 id='portfolios-label'>"+text2+"</h3>";
				html += "<div id='portfolios'></div>";
				if (USER.admin || USER.creator) {
					var text2 = karutaStr[LANG]['bin'];
					if (USER.admin)
						text2 = karutaStr[LANG]['bin-admin'];
					html += "<h3 id='bin-label'>"+text2+"</h3>";
					html += "<div  id='bin'>";
				}
				html += "</div>";
				return html;
			}
			//------------------------------
			var lang = getURLParameter('lang');
			if (lang!=null) {
				LANG = lang;
				for (var i=0; i<languages.length;i++){
					if (languages[i]==lang)
						LANGCODE = i;
				}
			}
			//------------------------------
		</script>
	</head>
	<body>
		<div id='main-body-list'>
			<div id='navigation_bar'></div>
			<div id='contenu' class="container-fluid page-list">
				<div id="welcome-image">
					<div class="welcome-box">
						<div class="welcome-subbox">
							<div id="welcome-title" class="welcome-title">Bienvenue dans KARUTA</div>
							<div class="welcome-line"></div>
							<div style="color:#18b8d6;text-align:center;" id="welcome-baseline" class="welcome-baseline">
								OPEN SOURCE PORTFOLIO
							</div><!-- id='welcome-baseline' -->
						</div><!--  class='welcome-subbox' -->
					</div><!--  class='welcome-box' -->
				</div>
				<div id='main-row' class='row'>
					<div class='col-md-3'>
					</div>
					<div class='col-md-6 projects'>
						<div id='menu'></div>
						<div id='list'></div>
					</div>
					<div class='col-md-3'>
					</div>
				</div>
			</div>
		</div>
		<div id='wait-window' class='modal hide'>
			<div id='info-window-body' class='modal-body' style='text-align:center'>
				<div>Processing<br><img src="../../karuta/img/loading30.gif"/></div>
			</div>
		</div>
		<script>
			g_elgg_key = getURLParameter('elgg_token');
			setLanguage();
			document.write(EditBox());
			$(window).load(function() {
				if (elgg_installed!=undefined && elgg_installed)
					$("#main-row").html("<div class='col-md-6'><div id='socialnetwork'><div id='socialnetwork-head'></div><div id='socialnetwork-body'></div></div></div><div class='col-md-6 projects'><div id='menu'></div><div id='list'></div></div>")
				changeCss("a.navbar-icon .glyphicon", "color:"+navbar_icon_color+";");
				//----------------
				$.ajaxSetup({async: false});
				// --- list of users to display name of owner
				$.ajax({
					type : "GET",
					dataType : "xml",
					url : "../../../"+serverBCK+"/users",
					success : function(data) {
						UIFactory["User"].parse(data);
					}
				});
				//-----------------------------------------
				$.ajax({
					type : "GET",
					dataType : "xml",
					url : "../../../"+serverBCK+"/credential",
					data: "",
					success : function(data) {
						USER = new UIFactory["User"]($("user",data));
						loadLanguages(function(data) {$("#navigation_bar").html(getNavBar('list',null));displaySocialNetwork('socialnetwork');$("#list").html(getList());});
						$.ajax({
							type : "GET",
							dataType : "xml",
							url : "../../../"+serverVER+"/version",
							data: "",
							success : function(data) {		
								karuta_backend_version = $("number",$("#backend",data)).text();
								karuta_backend_date = $("date",$("#backend",data)).text();
								karuta_fileserver_version = $("number",$("#fileserver",data)).text();
								karuta_fileserver_date = $("date",$("#fileserver",data)).text();
								$("#navigation_bar").html(getNavBar('list',null));
							}
						});
						var html = "";
						html += "<div class='dropdown dropdown-button'>";
						html += "<span id='list-menu' class='button' data-toggle='dropdown' type='button' aria-haspopup='true' aria-expanded='false'><span class='glyphicon glyphicon-menu-hamburger'></span>&nbsp;Menu</span>";
						html += "<ul class='dropdown-menu' role='menu' aria-labelledby='list-menu'>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].createProject()\" href='#'>"+karutaStr[LANG]['create_project']+"</a></li>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].create()\" href='#'>"+karutaStr[LANG]['create_tree']+"</a></li>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].createPortfolio()\" href='#'>"+karutaStr[LANG]['create_portfolio']+"</a></li>";
						html += "<hr>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].createBatch()\" href='#'>"+karutaStr[LANG]['create_batch']+"</a></li>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].createReport()\" href='#'>"+karutaStr[LANG]['create_report']+"</a></li>";
						html += "<hr>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].importFile(true)\" href='#'>"+karutaStr[LANG]['import_instance']+"</a></li>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].importFile()\" href='#'>"+karutaStr[LANG]['import_portfolio']+"</a></li>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].importZip(true)\" href='#'>"+karutaStr[LANG]['import_zip_instance']+"</a></li>";
						html += "<li><a onclick=\"javascript:UIFactory['Portfolio'].importZip()\" href='#'>"+karutaStr[LANG]['import_zip']+"</a></li>";
						html += "<hr>";
						html += "<li><a onclick=\"share_karuta_documentation()\" href='#'>"+karutaStr[LANG]['demo-documentation']+"</a></li>";
						if (demo) {
							html += "<hr>";
							html += "<li><a onclick=\"create_karuta_demo_aacu('"+USER.username_node.text()+"')\" href='#'>"+karutaStr[LANG]['demo-aacu']+"</a></li>";
							html += "<li><a onclick=\"create_karuta_demo_video('"+USER.username_node.text()+"')\" href='#'>"+karutaStr[LANG]['demo-video']+"</a></li>";
							html += "<li><a onclick=\"create_karuta_demo_ecommerce('"+USER.username_node.text()+"')\" href='#'>"+karutaStr[LANG]['demo-ecommerce']+"</a></li>";
						}
						html += "</ul>";
						html += "</div>";
						if (USER.admin || USER.creator){
							$("#menu").html(html);
							if (demo) {
								$("#start").html(listinfo[LANG]);
								$("#start").attr('style','visibility:visible');
							}
						}
						//----------------
						$.ajax({
							type : "GET",
							dataType : "xml",
							url : "../../../"+serverBCK+"/portfolios?active=1",
							success : function(data) {
								var destid = $("div[id='portfolios']");
								UIFactory["Portfolio"].parse(data);
								UIFactory["Portfolio"].displayAll('portfolios','list');
							},
							error : function(jqxhr,textStatus) {
								alert("Server Error GET active: "+textStatus);
							}
						});
						//----------------
						if (USER.admin || USER.creator) {
							$.ajax({
								type : "GET",
								dataType : "xml",
								url : "../../../"+serverBCK+"/portfolios?active=false",
								success : function(data) {
									var destid = $("div[id='bin']");
									UIFactory["Portfolio"].parseBin(data);
									UIFactory["Portfolio"].displayBin('bin','bin');
								},
								error : function(jqxhr,textStatus) {
									alert("Server Error GET bin: "+textStatus);
								}
							});
						}
						//----------------
					},
					error : function(jqxhr,textStatus) {
						loadLanguages(function(data) {alert(karutaStr[LANG]['not-logged']);});
						window.location="login.htm?lang="+LANG;
					}
				});
				$.ajaxSetup({async: true});
				var navbar_html = getNavBar('list',null);
				$("#navigation_bar").html(navbar_html);
			});
		</script>
	</body>
</html>